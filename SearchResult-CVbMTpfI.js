import{d as V,i as W,j as X,k as Z,l as ee,m as se,n as ae,p as C,q as B,s as e,v as le,x as te,y as re,R as $,z as ie,A as oe,B as ue,C as ce,D as ne,E as I,G as j,H as de,I as ve,J as me,K as he,L as ye,M as ge,N as pe,O as Ee,P as M,Q as be,S as H}from"./app-4snGr-mi.js";const we=["/","/friend.html","/intro.html","/blog/","/blog/android/","/blog/android/lsposed.html","/blog/instruction/","/blog/instruction/flighttrader.html","/blog/instruction/jerrymsmg.html","/blog/instruction/syslite.html","/blog/play/","/blog/play/macsimulator.html","/blog/play/sxslite.html","/blog/resources/","/blog/resources/win10.html","/blog/resources/win11.html","/blog/resources/win7.html","/blog/talk/","/blog/talk/mactrick.html","/blog/talk/website.html","/404.html","/category/","/category/%E5%AE%89%E5%8D%93%E7%8E%A9%E6%9C%BA/","/category/%E6%95%99%E7%A8%8B/","/category/%E6%95%B4%E6%B4%BB/","/category/%E8%B5%84%E6%BA%90/","/category/%E6%9D%82%E8%B0%88/","/tag/","/tag/root/","/tag/%E5%AE%89%E5%8D%93/","/tag/xp%E6%A8%A1%E5%9D%97/","/tag/%E5%85%8D%E8%B4%B9/","/tag/msmg/","/tag/%E7%B3%BB%E7%BB%9F%E7%B2%BE%E7%AE%80%E4%BC%98%E5%8C%96/","/tag/macos/","/tag/ios/","/tag/simulator/","/tag/winsxs/","/tag/windows/","/tag/windows10/","/tag/windows11/","/tag/windows7/","/tag/windows8.1/","/tag/%E8%AF%88%E9%AA%97/","/tag/%E5%BB%BA%E7%AB%99/","/tag/%E5%8E%86%E7%A8%8B/","/article/","/star/","/timeline/"],fe="SLIMSEARCH_QUERY_HISTORY",p=M(fe,[]),Be=()=>{const{queryHistoryCount:t}=H;return{enabled:t>0,queryHistories:p,addQueryHistory:u=>{p.value=Array.from(new Set([u,...p.value.slice(0,t-1)]))},removeQueryHistory:u=>{p.value=[...p.value.slice(0,u),...p.value.slice(u+1)]}}},q=t=>we[t.id]+("anchor"in t?`#${t.anchor}`:""),He="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:T}=H,E=M(He,[]),ke=()=>({enabled:T>0,resultHistories:E,addResultHistory:o=>{{const u={link:q(o),display:o.display};"header"in o&&(u.header=o.header),E.value=[u,...E.value.slice(0,T-1)]}},removeResultHistory:o=>{E.value=[...E.value.slice(0,o),...E.value.slice(o+1)]}}),Ae=t=>{const{page:o,routeLocale:u}=de(),k=ve(),r=C(0),b=B(()=>r.value>0),d=me([]);return he(()=>{const{search:A,terminate:h}=ye(),w=pe(y=>{const{resultsFilter:x=l=>l,querySplitter:g,suggestionsFilter:D,...i}=k.value;y?(r.value+=1,A(y,u.value,i).then(l=>x(l,y,u.value,o.value)).then(l=>{r.value-=1,d.value=l}).catch(l=>{console.warn(l),r.value-=1,r.value||(d.value=[])})):d.value=[]},H.searchDelay-H.suggestDelay,{maxWait:5e3});ge([t,u],([y])=>w(y.join(" "))),Ee(()=>{h()})}),{isSearching:b,results:d}};var Qe=V({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(t,{emit:o}){const u=W(),k=X(),r=Z(ee),{addQueryHistory:b,queryHistories:d,removeQueryHistory:A}=Be(),{resultHistories:h,addResultHistory:w,removeResultHistory:y}=ke(),x=se(t,"queries"),{results:g,isSearching:D}=Ae(x),i=ae({isQuery:!0,index:0}),l=C(0),v=C(0),L=B(()=>d.value.length>0||h.value.length>0),Q=B(()=>g.value.length>0),R=B(()=>g.value[l.value]||null),O=()=>{const{isQuery:s,index:a}=i;a===0?(i.isQuery=!s,i.index=s?h.value.length-1:d.value.length-1):i.index=a-1},P=()=>{const{isQuery:s,index:a}=i;a===(s?d.value.length-1:h.value.length-1)?(i.isQuery=!s,i.index=0):i.index=a+1},U=()=>{l.value=l.value>0?l.value-1:g.value.length-1,v.value=R.value.contents.length-1},_=()=>{l.value=l.value<g.value.length-1?l.value+1:0,v.value=0},Y=()=>{v.value<R.value.contents.length-1?v.value+=1:_()},z=()=>{v.value>0?v.value-=1:U()},S=s=>s.map(a=>be(a)?a:e(a[0],a[1])),G=s=>{if(s.type==="customField"){const a=ce[s.index]||"$content",[m,c=""]=ne(a)?a[k.value].split("$content"):a.split("$content");return s.display.map(n=>e("div",S([m,...n,c])))}return s.display.map(a=>e("div",S(a)))},f=()=>{l.value=0,v.value=0,o("updateQuery",""),o("close")},J=()=>e("div",{class:"slimsearch-records"},e("div",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.queryHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},d.value.map((s,a)=>{const m=i.isQuery&&i.index===a;return e("li",{class:["slimsearch-record-matches",{active:m}],role:"option","aria-selected":m,onClick:()=>{o("updateQuery",s)}},e("div",[e(I,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},s),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:j,onClick:c=>{c.preventDefault(),c.stopPropagation(),A(a)}})]))}))])),K=()=>e("ul",{class:"slimsearch-records"},e("li",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.resultHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},h.value.map((s,a)=>{const m=!i.isQuery&&i.index===a;return e("li",{class:["slimsearch-record-matches",{active:m}],role:"option","aria-selected":m},e($,{to:s.link,onClick:()=>{f()}},()=>[e(I,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[s.header?e("div",{class:"slimsearch-record-content-header"},s.header):null,e("div",s.display.map(c=>S(c)).flat())]),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:j,onClick:c=>{c.preventDefault(),c.stopPropagation(),y(a)}})]))}))]));return le("keydown",s=>{if(t.isFocusing){if(Q.value){if(s.key==="ArrowUp")z();else if(s.key==="ArrowDown")Y();else if(s.key==="Enter"){const a=R.value.contents[v.value];b(t.queries.join(" ")),w(a),u.push(q(a)),f()}}else if(s.key==="ArrowUp")O();else if(s.key==="ArrowDown")P();else if(s.key==="Enter"){const{index:a}=i;i.isQuery?(s.preventDefault(),o("updateQuery",d.value[a])):(u.push(h.value[a].link),f())}}}),te([l,v],()=>{var s;(s=document.querySelector(".slimsearch-record.active .slimsearch-record-matches.active"))==null||s.scrollIntoView(!1)},{flush:"post"}),()=>e("div",{id:"slimsearch-results",class:["slimsearch-result-wrapper",{empty:t.queries.length?!Q.value:!L.value}]},t.queries.length?D.value?e(re,{hint:r.value.searching}):Q.value?e("div",{class:"slimsearch-records",role:"listbox","aria-labeledby":"slimsearch-label"},g.value.map(({title:s,contents:a},m)=>{const c=l.value===m;return e("div",{class:["slimsearch-record",{active:c}],role:"group","aria-selected":c},[e("div",{class:"slimsearch-record-title"},s||r.value.defaultTitle),e("ul",{class:"slimsearch-record-contents"},a.map((n,N)=>{const F=c&&v.value===N;return e("li",{class:["slimsearch-record-matches",{active:F}],role:"option","aria-selected":F},e($,{to:q(n),onClick:()=>{b(t.queries.join(" ")),w(n),f()}},()=>[n.type==="text"?null:e(n.type==="title"?ie:n.type==="heading"?oe:ue,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[n.type==="text"&&n.header?e("div",{class:"slimsearch-record-content-header"},n.header):null,e("div",G(n))])]))}))])})):r.value.emptyResult:L.value?[J(),K()]:r.value.emptyHistory)}});export{Qe as default};
