import{f as N,u as X,g as M,h as Z,j as ee,t as se,i as le,k as S,l as H,m as e,n as ae,p as te,s as re,R as $,q as ie,v as oe,x as ue,y as ce,z as ne,A as I,B as T,C as de,D as ve,E as me,F as he,L as ye,G as ge,H as pe,I as be,J as U,K as we,M as B}from"./app-BRo1-gFd.js";const Ee=["/","/friend.html","/intro.html","/blog/","/blog/play/","/blog/play/macsimulator.html","/blog/play/sxslite.html","/blog/resources/","/blog/resources/win10.html","/blog/resources/win11.html","/blog/resources/win7.html","/blog/talk/","/blog/talk/mactrick.html","/blog/talk/website.html","/blog/instruction/","/blog/instruction/jerrymsmg.html","/blog/instruction/syslite1.html","/404.html","/category/","/category/%E6%95%B4%E6%B4%BB/","/category/%E8%B5%84%E6%BA%90/","/category/%E6%9D%82%E8%B0%88/","/category/%E6%95%99%E7%A8%8B/","/tag/","/tag/macos/","/tag/ios/","/tag/simulator/","/tag/%E7%B3%BB%E7%BB%9F%E7%B2%BE%E7%AE%80%E4%BC%98%E5%8C%96/","/tag/winsxs/","/tag/windows/","/tag/windows10/","/tag/windows11/","/tag/windows7/","/tag/windows8.1/","/tag/%E8%AF%88%E9%AA%97/","/tag/%E5%BB%BA%E7%AB%99/","/tag/%E5%8E%86%E7%A8%8B/","/tag/msmg/","/article/","/star/","/timeline/"],fe="SLIMSEARCH_QUERY_HISTORY",p=U(fe,[]),He=()=>{const{queryHistoryCount:t}=B;return{enabled:t>0,queryHistories:p,addQueryHistory:u=>{p.value=Array.from(new Set([u,...p.value.slice(0,t-1)]))},removeQueryHistory:u=>{p.value=[...p.value.slice(0,u),...p.value.slice(u+1)]}}},q=t=>Ee[t.id]+("anchor"in t?`#${t.anchor}`:""),Be="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:j}=B,b=U(Be,[]),xe=()=>({enabled:j>0,resultHistories:b,addResultHistory:o=>{{const u={link:q(o),display:o.display};"header"in o&&(u.header=o.header),b.value=[u,...b.value.slice(0,j-1)]}},removeResultHistory:o=>{b.value=[...b.value.slice(0,o),...b.value.slice(o+1)]}}),ke=t=>{const o=de(),u=M(),x=ve(),r=S(0),w=H(()=>r.value>0),d=me([]);return he(()=>{const{search:k,terminate:h}=ye(),E=pe(y=>{const{resultsFilter:Q=a=>a,querySplitter:g,suggestionsFilter:D,...i}=o.value;y?(r.value+=1,k(y,u.value,i).then(a=>Q(a,y,u.value,x.value)).then(a=>{r.value-=1,d.value=a}).catch(a=>{console.warn(a),r.value-=1,r.value||(d.value=[])})):d.value=[]},B.searchDelay-B.suggestDelay,{maxWait:5e3});ge([t,u],([y])=>E(y.join(" "))),be(()=>{h()})}),{isSearching:w,results:d}};var Re=N({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(t,{emit:o}){const u=X(),x=M(),r=Z(ee),{addQueryHistory:w,queryHistories:d,removeQueryHistory:k}=He(),{resultHistories:h,addResultHistory:E,removeResultHistory:y}=xe(),Q=se(t,"queries"),{results:g,isSearching:D}=ke(Q),i=le({isQuery:!0,index:0}),a=S(0),v=S(0),L=H(()=>d.value.length>0||h.value.length>0),R=H(()=>g.value.length>0),A=H(()=>g.value[a.value]||null),_=()=>{const{isQuery:s,index:l}=i;l===0?(i.isQuery=!s,i.index=s?h.value.length-1:d.value.length-1):i.index=l-1},O=()=>{const{isQuery:s,index:l}=i;l===(s?d.value.length-1:h.value.length-1)?(i.isQuery=!s,i.index=0):i.index=l+1},P=()=>{a.value=a.value>0?a.value-1:g.value.length-1,v.value=A.value.contents.length-1},Y=()=>{a.value=a.value<g.value.length-1?a.value+1:0,v.value=0},z=()=>{v.value<A.value.contents.length-1?v.value+=1:Y()},G=()=>{v.value>0?v.value-=1:P()},C=s=>s.map(l=>we(l)?l:e(l[0],l[1])),J=s=>{if(s.type==="customField"){const l=ce[s.index]||"$content",[m,c=""]=ne(l)?l[x.value].split("$content"):l.split("$content");return s.display.map(n=>e("div",C([m,...n,c])))}return s.display.map(l=>e("div",C(l)))},f=()=>{a.value=0,v.value=0,o("updateQuery",""),o("close")},K=()=>e("div",{class:"slimsearch-records"},e("div",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.queryHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},d.value.map((s,l)=>{const m=i.isQuery&&i.index===l;return e("li",{class:["slimsearch-record-matches",{active:m}],role:"option","aria-selected":m,onClick:()=>{o("updateQuery",s)}},e("div",[e(I,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},s),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:T,onClick:c=>{c.preventDefault(),c.stopPropagation(),k(l)}})]))}))])),V=()=>e("ul",{class:"slimsearch-records"},e("li",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.resultHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},h.value.map((s,l)=>{const m=!i.isQuery&&i.index===l;return e("li",{class:["slimsearch-record-matches",{active:m}],role:"option","aria-selected":m},e($,{to:s.link,onClick:()=>{f()}},()=>[e(I,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[s.header?e("div",{class:"slimsearch-record-content-header"},s.header):null,e("div",s.display.map(c=>C(c)).flat())]),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:T,onClick:c=>{c.preventDefault(),c.stopPropagation(),y(l)}})]))}))]));return ae("keydown",s=>{if(t.isFocusing){if(R.value){if(s.key==="ArrowUp")G();else if(s.key==="ArrowDown")z();else if(s.key==="Enter"){const l=A.value.contents[v.value];w(t.queries.join(" ")),E(l),u.push(q(l)),f()}}else if(s.key==="ArrowUp")_();else if(s.key==="ArrowDown")O();else if(s.key==="Enter"){const{index:l}=i;i.isQuery?(s.preventDefault(),o("updateQuery",d.value[l])):(u.push(h.value[l].link),f())}}}),te([a,v],()=>{var s;(s=document.querySelector(".slimsearch-record.active .slimsearch-record-matches.active"))==null||s.scrollIntoView(!1)},{flush:"post"}),()=>e("div",{id:"slimsearch-results",class:["slimsearch-result-wrapper",{empty:t.queries.length?!R.value:!L.value}]},t.queries.length?D.value?e(re,{hint:r.value.searching}):R.value?e("div",{class:"slimsearch-records",role:"listbox","aria-labeledby":"slimsearch-label"},g.value.map(({title:s,contents:l},m)=>{const c=a.value===m;return e("div",{class:["slimsearch-record",{active:c}],role:"group","aria-selected":c},[e("div",{class:"slimsearch-record-title"},s||r.value.defaultTitle),e("ul",{class:"slimsearch-record-contents"},l.map((n,W)=>{const F=c&&v.value===W;return e("li",{class:["slimsearch-record-matches",{active:F}],role:"option","aria-selected":F},e($,{to:q(n),onClick:()=>{w(t.queries.join(" ")),E(n),f()}},()=>[n.type==="text"?null:e(n.type==="title"?ie:n.type==="heading"?oe:ue,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[n.type==="text"&&n.header?e("div",{class:"slimsearch-record-content-header"},n.header):null,e("div",J(n))])]))}))])})):r.value.emptyResult:L.value?[K(),V()]:r.value.emptyHistory)}});export{Re as default};
